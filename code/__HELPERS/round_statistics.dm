// Census
#define STATS_ALIVE_NORTHERN_HUMANS "alive_northern_humans"
#define STATS_ALIVE_DWARVES "alive_dwarves"
#define STATS_ALIVE_DARK_ELVES "alive_dark_elves"
#define STATS_ALIVE_SNOW_ELVES "alive_snow_elves"
#define STATS_ALIVE_HALF_ELVES "alive_half_elves"
#define STATS_ALIVE_HALF_DROWS "alive_half_drows"
#define STATS_ALIVE_HALF_ORCS "alive_half_orcs"
#define STATS_ALIVE_KOBOLDS "alive_kobolds"
#define STATS_ALIVE_RAKSHARI "alive_rakshari"
#define STATS_ALIVE_AASIMAR "alive_aasimar"
#define STATS_ALIVE_TIEFLINGS "alive_tieflings"
#define STATS_ALIVE_HOLLOWKINS "alive_hollowkins"
#define STATS_ALIVE_HARPIES "alive_harpies"
#define STATS_VAMPIRES "vampires"

#define STATS_ALIVE_GARRISON "alive_garrison"
#define STATS_ALIVE_CLERGY "alive_clergy"
#define STATS_ALIVE_TRADESMEN "alive_tradesmen"

#define STATS_MONARCH_PATRON "monarch_patron"
#define STATS_TOTAL_POPULATION "total_population"
#define STATS_MARRIED "married"

#define STATS_MALE_POPULATION "male_population"
#define STATS_FEMALE_POPULATION "female_population"
#define STATS_OTHER_GENDER "other_gender_population"

#define STATS_CHILD_POPULATION "child_population"
#define STATS_ADULT_POPULATION "adult_population"
#define STATS_MIDDLEAGED_POPULATION "middleaged_population"
#define STATS_ELDERLY_POPULATION "elderly_population"
#define STATS_IMMORTAL_POPULATION "immortal_population"

// General statistics
#define STATS_MOAT_FALLERS "moat_fallers"
#define STATS_ANKLES_BROKEN "ankles_broken"
#define STATS_PEOPLE_SMITTEN "smited"
#define STATS_TRIUMPHS_AWARDED "triumph_gained"
#define STATS_TRIUMPHS_STOLEN "triumph_lost"
#define STATS_PRAYERS_MADE "prayers_made"
#define STATS_KISSES_MADE "kisses_made"
#define STATS_SKILLS_LEARNED "skills_learned"
#define STATS_DEADITES_ALIVE "deadites_alive"
#define STATS_KLEPTOMANIACS "kleptomaniacs"
#define STATS_LUX_REVIVALS "lux_revivals"
#define STATS_TAXES_COLLECTED "taxes_collected"

// Influence related statistics

// Psydon
#define STATS_HUMEN_DEATHS "humen_deaths"
#define STATS_PSYCROSS_USERS "people_wearing_psycross"
#define STATS_LUX_HARVESTED "lux_harvested"

// Astrata
#define STATS_LAWS_AND_DECREES_MADE "laws_and_decrees_made"
#define STATS_ALIVE_NOBLES "alive_nobles"
#define STATS_NOBLE_DEATHS "noble_deaths"
#define STATS_ASTRATA_REVIVALS "astrata_revivals"
#define STATS_SLURS_SPOKEN "slurs_spoken"

// Noc
#define STATS_BOOKS_PRINTED "books_printed"
#define STATS_LITERACY_TAUGHT "literacy_taught"
#define STATS_ILLITERATES "illiterates"
#define STATS_SKILLS_DREAMED "skills_dreamed"
#define STATS_MANA_SPENT "mana_spent"

// Necra
#define STATS_DEATHS "deaths"
#define STATS_GRAVES_CONSECRATED "graves_consecrated"
#define STATS_GRAVES_ROBBED "graves_robbed"
#define STATS_DEADITES_KILLED "deadites_killed"
#define STATS_VAMPIRES_KILLED "vampires_killed"

// Pestra
#define STATS_POTIONS_BREWED "potions_brewed"
#define STATS_WOUNDS_SEWED "wounds_sewed"
#define STATS_SOULS_REINCARNATED "souls_reincarnated"
#define STATS_ANIMALS_BRED "animals_bred"
#define STATS_FOOD_ROTTED "food_rotted"

// Dendor
#define STATS_TREES_CUT "trees_cut"
#define STATS_PLANTS_HARVESTED "plants_harvested"
#define STATS_WEREVOLVES "werevolves"
#define STATS_DENDOR_SACRIFICES "dendor_sacrifices"
#define STATS_FOREST_DEATHS "forest_deaths"

// Ravox
#define STATS_COMBAT_SKILLS "combat_skills"
#define STATS_PARRIES "parries"
#define STATS_WARCRIES "warcries"
#define STATS_YIELDS "yields"
#define STATS_UNDERWORLD_DUELS "underworld_duels"

// Xylix
#define STATS_LAUGHS_MADE "laughs_made"
#define STATS_GAMES_RIGGED "games_rigged"
#define STATS_PEOPLE_MOCKED "people_mocked"
#define STATS_CRITS_MADE "crits_made"
#define STATS_SONGS_PLAYED "songs_played"

// Malum
#define STATS_MASTERWORKS_FORGED "masterworks_forged"
#define STATS_ROCKS_MINED "ores_mined"
#define STATS_CRAFT_SKILLS "craft_skills"
#define STATS_BEARDS_SHAVED "beards_shaved"
#define STATS_BLACKSTEEL_SMELTED "blacksteel_smelted"

// Abyssor
#define STATS_WATER_CONSUMED "water_consumed"
#define STATS_FISH_CAUGHT "fish_caught"
#define STATS_ABYSSOR_REMEMBERED "abyssor_remembered"
#define STATS_LEECHES_EMBEDDED "leeches_embedded"
#define STATS_PEOPLE_DROWNED "people_drowned"

// Eora
#define STATS_PARENTS "parents"
#define STATS_MARRIAGES "marriages"
#define STATS_HUGS_MADE "hugs_made"
#define STATS_HANDS_HELD "hands_held"
#define STATS_PACIFISTS "pacifists"

// Zizo
#define STATS_ZIZO_PRAISED "zizo_praised"
#define STATS_DEADITES_WOKEN_UP "deadites_woken_up"
#define STATS_CLERGY_DEATHS "clergy_deaths"
#define STATS_TORTURES "tortures"

// Graggar
#define STATS_BLOOD_SPILT "blood_lost"
#define STATS_ORGANS_EATEN "organs_eaten"
#define STATS_PEOPLE_GIBBED "gibbed"
#define STATS_ASSASSINATIONS "assassinations"
#define STATS_LIMBS_BITTEN "limbs_bitten"

// Baotha
#define STATS_DRUGS_SNORTED "snorted_drugs"
#define STATS_ALCOHOL_CONSUMED "alcohol_consumed"
#define STATS_ALCOHOLICS "alcoholics"
#define STATS_JUNKIES "junkies"
#define STATS_LUXURIOUS_FOOD_EATEN "luxurious_food_eaten"

// Matthios
#define STATS_ITEMS_PICKPOCKETED "items_pickpocketed"
#define STATS_SHRINE_VALUE "shrine_value"
#define STATS_GREEDY_PEOPLE "greedy_people"
#define STATS_DODGES "dodges"
#define STATS_LOCKS_PICKED "locks_picked"

GLOBAL_LIST_INIT(vanderlin_round_stats, list(
	STATS_DEATHS = 0,
	STATS_NOBLE_DEATHS = 0,
	STATS_MOAT_FALLERS = 0,
	STATS_ANKLES_BROKEN = 0,
	STATS_PEOPLE_SMITTEN = 0,
	STATS_BLOOD_SPILT = 0,
	STATS_PEOPLE_GIBBED = 0,
	STATS_TRIUMPHS_AWARDED = 0,
	STATS_TRIUMPHS_STOLEN = 0,
	STATS_DRUGS_SNORTED = 0,
	STATS_BEARDS_SHAVED = 0,
	STATS_TREES_CUT = 0,
	STATS_PRAYERS_MADE = 0,
	STATS_FISH_CAUGHT = 0,
	STATS_ITEMS_PICKPOCKETED = 0,
	STATS_MASTERWORKS_FORGED = 0,
	STATS_TAXES_COLLECTED = 0,
	STATS_ORGANS_EATEN = 0,
	STATS_KISSES_MADE = 0,
	STATS_LAUGHS_MADE = 0,
	STATS_GRAVES_CONSECRATED = 0,
	STATS_POTIONS_BREWED = 0,
	STATS_ASTRATA_REVIVALS = 0,
	STATS_PLANTS_HARVESTED = 0,
	STATS_LAWS_AND_DECREES_MADE = 0,
	STATS_ALIVE_NOBLES = 0,
	STATS_BOOKS_PRINTED = 0,
	STATS_LITERACY_TAUGHT = 0,
	STATS_ILLITERATES = 0,
	STATS_SKILLS_LEARNED = 0,
	STATS_GRAVES_ROBBED = 0,
	STATS_DEADITES_KILLED = 0,
	STATS_VAMPIRES_KILLED = 0,
	STATS_WOUNDS_SEWED = 0,
	STATS_SOULS_REINCARNATED = 0,
	STATS_ANIMALS_BRED = 0,
	STATS_WEREVOLVES = 0,
	STATS_DENDOR_SACRIFICES = 0,
	STATS_COMBAT_SKILLS = 0,
	STATS_PARRIES = 0,
	STATS_WARCRIES = 0,
	STATS_YIELDS = 0,
	STATS_GAMES_RIGGED = 0,
	STATS_PEOPLE_MOCKED = 0,
	STATS_CRITS_MADE = 0,
	STATS_ROCKS_MINED = 0,
	STATS_CRAFT_SKILLS = 0,
	STATS_ABYSSOR_REMEMBERED = 0,
	STATS_LEECHES_EMBEDDED = 0,
	STATS_MARRIAGES = 0,
	STATS_HUGS_MADE = 0,
	STATS_ZIZO_PRAISED = 0,
	STATS_DEADITES_ALIVE = 0,
	STATS_CLERGY_DEATHS = 0,
	STATS_ASSASSINATIONS = 0,
	STATS_ALCOHOL_CONSUMED = 0,
	STATS_ALCOHOLICS = 0,
	STATS_JUNKIES = 0,
	STATS_SHRINE_VALUE = 0,
	STATS_GREEDY_PEOPLE = 0,
	STATS_KLEPTOMANIACS = 0,
	STATS_HUMEN_DEATHS = 0,
	STATS_PARENTS = 0,
	STATS_SKILLS_DREAMED = 0,
	STATS_ALIVE_NORTHERN_HUMANS = 0,
	STATS_ALIVE_DWARVES = 0,
	STATS_ALIVE_DARK_ELVES = 0,
	STATS_ALIVE_SNOW_ELVES = 0,
	STATS_ALIVE_HALF_ELVES = 0,
	STATS_ALIVE_HALF_DROWS = 0,
	STATS_ALIVE_HALF_ORCS = 0,
	STATS_ALIVE_KOBOLDS = 0,
	STATS_ALIVE_RAKSHARI = 0,
	STATS_ALIVE_AASIMAR = 0,
	STATS_ALIVE_TIEFLINGS = 0,
	STATS_ALIVE_HOLLOWKINS = 0,
	STATS_ALIVE_HARPIES = 0,
	STATS_PEOPLE_DROWNED = 0,
	STATS_MANA_SPENT = 0,
	STATS_WATER_CONSUMED  = 0,
	STATS_LIMBS_BITTEN = 0,
	STATS_UNDERWORLD_DUELS = 0,
	STATS_LOCKS_PICKED = 0,
	STATS_SONGS_PLAYED = 0,
	STATS_FOOD_ROTTED = 0,
	STATS_BLACKSTEEL_SMELTED = 0,
	STATS_PACIFISTS = 0,
	STATS_FOREST_DEATHS = 0,
	STATS_TORTURES = 0,
	STATS_LUXURIOUS_FOOD_EATEN = 0,
	STATS_DEADITES_WOKEN_UP = 0,
	STATS_DODGES = 0,
	STATS_MARRIED = 0,
	STATS_MONARCH_PATRON = "No Ruler",
	STATS_MALE_POPULATION = 0,
	STATS_FEMALE_POPULATION = 0,
	STATS_OTHER_GENDER = 0,
	STATS_CHILD_POPULATION = 0,
	STATS_ADULT_POPULATION = 0,
	STATS_MIDDLEAGED_POPULATION = 0,
	STATS_ELDERLY_POPULATION = 0,
	STATS_IMMORTAL_POPULATION = 0,
	STATS_PSYCROSS_USERS = 0,
	STATS_VAMPIRES = 0,
	STATS_LUX_HARVESTED = 0,
	STATS_TOTAL_POPULATION = 0,
	STATS_ALIVE_GARRISON = 0,
	STATS_ALIVE_CLERGY = 0,
	STATS_ALIVE_TRADESMEN = 0,
	STATS_LUX_REVIVALS = 0,
	STATS_SLURS_SPOKEN = 0,
	STATS_HANDS_HELD = 0,
))

GLOBAL_LIST_EMPTY(patron_follower_counts)

// Featured stats of the round
#define FEATURED_STATS_TREE_FELLERS "tree_fellers"
#define FEATURED_STATS_THIEVES "thieves"
#define FEATURED_STATS_ALCHEMISTS "alchemists"
#define FEATURED_STATS_TAX_PAYERS "tax_payers"
#define FEATURED_STATS_ALCOHOLICS "alcohol_drinkers"
#define FEATURED_STATS_SPEAKERS "speakers"
#define FEATURED_STATS_SLURS "slurs"
#define FEATURED_STATS_SPECIESISTS "speciesists"
#define FEATURED_STATS_FISHERS "fishers"
#define FEATURED_STATS_EATERS "eaters"
#define FEATURED_STATS_SCREAMERS "screamers"
#define FEATURED_STATS_MINERS "miners"
#define FEATURED_STATS_CRIMINALS "criminals"
#define FEATURED_STATS_MAGES "mages"
#define FEATURED_STATS_CRAFTERS "crafters"
#define FEATURED_STATS_FARMERS "farmers"
#define FEATURED_STATS_STORYTELLERS "storytellers"
#define FEATURED_STATS_SMITHS "smiths"
#define FEATURED_STATS_BLEEDERS "bleeders"

// Featured objects stats
#define FEATURED_STATS_CRAFTED_ITEMS "crafted_items"
#define FEATURED_STATS_FORGED_ITEMS "forged_items"
#define FEATURED_STATS_DRINKS "drinks"
#define FEATURED_STATS_FOOD "food"
#define FEATURED_STATS_SPELLS "spells"
#define FEATURED_STATS_CROPS "crops"
#define FEATURED_STATS_FLAWS "flaws"

GLOBAL_LIST_INIT(featured_stats, list(
	FEATURED_STATS_TREE_FELLERS = list(
		"name" = "TOP Lumberjacks",
		"color" = "#9b6937",
		"entries" = list()
	),
	FEATURED_STATS_TAX_PAYERS = list(
		"name" = "TOP Tax Payers",
		"color" = "#f1e35d",
		"entries" = list()
	),
	FEATURED_STATS_CRIMINALS = list(
		"name" = "TOP Criminals",
		"color" = "#bb6976",
		"entries" = list()
	),
	FEATURED_STATS_SPEAKERS = list(
		"name" = "TOP Speakers",
		"color" = "#93cabe",
		"entries" = list()
	),
	FEATURED_STATS_SLURS = list(
		"name" = "TOP Slurs",
		"color" = "#5d44af",
		"entries" = list()
	),
	FEATURED_STATS_SPECIESISTS = list(
		"name" = "TOP Speciesists",
		"color" = "#49eb14",
		"entries" = list()
	),
	FEATURED_STATS_MINERS = list(
		"name" = "TOP Miners",
		"color" = "#bd8e60",
		"entries" = list()
	),
	FEATURED_STATS_ALCHEMISTS = list(
		"name" = "TOP Alchemists",
		"color" = "#3bac5d",
		"entries" = list()
	),
	FEATURED_STATS_BLEEDERS = list(
		"name" = "TOP Bleeders",
		"color" = "#d34747",
		"entries" = list()
	),
	FEATURED_STATS_STORYTELLERS = list(
		"name" = "TOP Reigning Gods",
		"color" = "#eeca2c",
		"entries" = list()
	),
	FEATURED_STATS_EATERS = list(
		"name" = "TOP Eaters",
		"color" = "#654dbe",
		"entries" = list()
	),
	FEATURED_STATS_FOOD = list(
		"name" = "TOP Food",
		"color" = "#73b647",
		"entries" = list()
	),
	FEATURED_STATS_FISHERS = list(
		"name" = "TOP Fishers",
		"color" = "#559bbb",
		"entries" = list()
	),
	FEATURED_STATS_CRAFTERS = list(
		"name" = "TOP Crafters",
		"color" = "#a59f4e",
		"entries" = list()
	),
	FEATURED_STATS_CRAFTED_ITEMS = list(
		"name" = "TOP Crafted Items",
		"color" = "#cfb834",
		"entries" = list(),
		"object_stat" = TRUE
	),
	FEATURED_STATS_SMITHS = list(
		"name" = "TOP Smiths",
		"color" = "#cc945c",
		"entries" = list()
	),
	FEATURED_STATS_FORGED_ITEMS = list(
		"name" = "TOP Forged Items",
		"color" = "#c08924",
		"entries" = list(),
		"object_stat" = TRUE
	),
	FEATURED_STATS_FARMERS = list(
		"name" = "TOP Farmers",
		"color" = "#50eb77",
		"entries" = list()
	),
	FEATURED_STATS_CROPS = list(
		"name" = "TOP Crops",
		"color" = "#a3db59",
		"entries" = list(),
		"object_stat" = TRUE
	),
	FEATURED_STATS_ALCOHOLICS = list(
		"name" = "TOP Alcoholics",
		"color" = "#945d96",
		"entries" = list()
	),
	FEATURED_STATS_DRINKS = list(
		"name" = "TOP Beverages",
		"color" = "#6a8dc2",
		"entries" = list(),
		"object_stat" = TRUE
	),
	FEATURED_STATS_SCREAMERS = list(
		"name" = "TOP Screamers",
		"color" = "#d34747",
		"entries" = list()
	),
	FEATURED_STATS_THIEVES = list(
		"name" = "TOP Thieves",
		"color" = "#6e4a25",
		"entries" = list()
	),
	FEATURED_STATS_MAGES = list(
		"name" = "TOP Mages",
		"color" = "#9eaceb",
		"entries" = list()
	),
	FEATURED_STATS_SPELLS = list(
		"name" = "TOP Spells",
		"color" = "#6375c5",
		"entries" = list(),
		"object_stat" = TRUE
	),
	FEATURED_STATS_FLAWS = list(
		"name" = "TOP Flaws",
		"color" = "#c7c569",
		"entries" = list(),
		"object_stat" = TRUE
	),
))

/proc/format_top_stats(stat_category)
	var/list/stat_data = GLOB.featured_stats[stat_category]
	if(!stat_data || !stat_data["entries"])
		return "Nobody"

	var/list/entries = list()
	for(var/key in stat_data["entries"])
		entries += list(list("name" = key, "count" = stat_data["entries"][key]))

	entries = sortList(entries, /proc/cmp_stat_count_desc)

	var/list/result = list()
	for(var/i in 1 to min(11, entries.len))
		var/list/entry = entries[i]
		var/rounded_count = round(entry["count"])
		result += "[i]. [entry["name"]] - [rounded_count]"

	return result.Join("<br>")

/proc/format_top_stats_objects(stat_category)
	var/list/stat_data = GLOB.featured_stats[stat_category]
	if(!stat_data || !stat_data["entries"])
		return "None"

	var/list/entries = list()
	for(var/key in stat_data["entries"])
		entries += list(list("name" = key, "count" = stat_data["entries"][key]))

	entries = sortList(entries, /proc/cmp_stat_count_desc)

	var/list/result = list()
	for(var/i in 1 to min(11, entries.len))
		var/list/entry = entries[i]
		var/rounded_count = round(entry["count"])
		result += "[i]. [entry["name"]] - [rounded_count]"

	return result.Join("<br>")

/proc/cmp_stat_count_desc(list/a, list/b)
	return b["count"] - a["count"]

/proc/record_featured_stat(stat_category, mob/living/user, increment = 1)
	if(SSticker.current_state == GAME_STATE_FINISHED)
		return
	if(!stat_category || !user?.real_name || !GLOB.featured_stats[stat_category])
		return

	var/list/stat_data = GLOB.featured_stats[stat_category]
	var/job_title = ""

	if(user.mind?.assigned_role.title != "Unassigned" && !is_unassigned_job(user.mind?.assigned_role))
		if(user.gender == FEMALE && user.mind.assigned_role.f_title)
			job_title = " ([user.mind.assigned_role.f_title])"
		else
			job_title = " ([user.mind.assigned_role.title])"
	else if(user.job && user.job != "Unassigned")
		job_title = " ([user.job])"
	else if(user.mind?.special_role)
		job_title = " ([user.mind.special_role])"
	else
		job_title = " (Jobless)"

	var/key = "[user.real_name][job_title]"

	if(!stat_data["entries"])
		stat_data["entries"] = list()

	stat_data["entries"][key] = (stat_data["entries"][key] || 0) + increment

/proc/record_featured_object_stat(stat_category, object_name, increment = 1)
	if(SSticker.current_state == GAME_STATE_FINISHED)
		return
	if(!stat_category || !object_name || !GLOB.featured_stats[stat_category])
		return

	var/list/stat_data = GLOB.featured_stats[stat_category]

	if(!stat_data["entries"])
		stat_data["entries"] = list()

	stat_data["entries"][object_name] = (stat_data["entries"][object_name] || 0) + increment
